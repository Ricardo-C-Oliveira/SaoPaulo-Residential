<html>

<head>
    <meta charset="UTF-8">

    <title>Sao Paulo</title>
    <script>L_PREFER_CANVAS = true;</script>

    <link rel="stylesheet" type="text/css" href="Style.css">
    
    <link href="//fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css"/>
	<link href="//fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css"/>

	 <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />

    <script src="plugins/jquery-1.11.2.min.js"></script>

    <script src="plugins/LeafletSlider-master/LeafletSlider-master/SliderControl.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>

    <link rel="stylesheet" href="plugins/sidebar/leaflet-sidebar.css">
    <link rel="stylesheet" href="plugins/font-awesome/font-awesome-4.3.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="plugins/highlight/styles/monokai.css">

    <script src="plugins/sidebar/leaflet-sidebar.js"></script>
    <script src="plugins/highlight/highlight.pack.js"></script>
    <link rel="stylesheet" href="plugins/highlight/styles/monokai.css">

    <link rel="stylesheet" href="plugins/intro.js-master/intro.js-master/introjs.css">
    <script src="plugins/intro.js-master/intro.js-master/intro.js"></script>


</head>


<body>


    <script type="text/javascript">
        //intro js
        $(function () {
            var introguide = introJs();
            introguide.setOptions({
                steps: [
                    {
                        element: document.querySelector('#map > div.leaflet-control-container > div.leaflet-bottom.leaflet-right > div.leaflet-control-layers.leaflet-control-layers-expanded.leaflet-control'),
                        intro: 'Check this box to show all developments at the same time, this may lead to decrease in performance.',
                        position: 'left'
    },
                    {
                        element: document.querySelector('#map > div.leaflet-control-container > div.leaflet-bottom.leaflet-right > div.slider.leaflet-control'),
                        intro: 'Move this slide to navigate trhough the years. Keep in mind that for performance reasons only 1500 points are displayed at a time.',
                        position: 'top'
    },
                    {
                        element: document.querySelector('#map > div.leaflet-control-container > div.leaflet-bottom.leaflet-right > div.info.legend.leaflet-control'),
                        intro: 'Although we have this handy legend here, explore the data by clicking the points to get specific years for each development.',
                        position: 'top'
    },
					{
					element: document.querySelector('#sidebar'),
					intro: 'Over here you will find more information about this project.',
					position: 'right'
				}

    ]
            });

            introguide.start();

        });
    </script>

    <script>
        //javascript highlight plugin
        hljs.initHighlightingOnLoad();
    </script>

    <div id="sidebar" class="sidebar collapsed">
        <!-- Nav tabs -->
        <ul class="sidebar-tabs" role="tablist">
            <li><a href="#home" role="tab"><i class="fa fa-question-circle"></i></a>
            </li>
            <li><a href="#changelog" role="tab"><i class="fa fa-gear"></i></a>
            </li>
            <li><a href="#contact" role="tab"><i class="fa fa-envelope"></i></a>
            </li>

        </ul>

        <!-- Tab panes -->
        <div class="sidebar-content active">
            <div class="sidebar-pane" id="home">
                <h1>SÃ£o Paulo's Residential Development</h1>

                <p class="lorem">This project started in the spring of 2015 as an independent study in the geography program at the University of Colorado at Denver. The goal of this project was to explore how to combine different FOSS4G (Free and Open Source Software for Geospatial Applications) technologies into a single product. The theme chosen for this project was the residential development evolution of the city of Sao Paulo, Brazil. </p>

               

            </div>
            <div class="sidebar-pane" id="changelog">
                <h1>Changelog</h1>

                <p class="lorem"><b>3/30/15</b> Add highlight.js to show snapshot of code.</p>
                <p class="lorem"><b>3/30/15</b> Removes fullscream function, was conflicting with sidepane.</p>
                <p class="lorem"><b>3/29/15</b> Add sidepane</p>
            </div>

            <div class="sidebar-pane" id="contact">
                <h1>Contact</h1>

                <p class="lorem"><b>Ricardo Oliveira</b> Geography and Enviromental Science - University of Colorado</p>
                <p class="lorem">ricardo.oliveira@ucdenver.edu</p>
            </div>

        </div>
    </div>

    <script rel="points" type="text/javascript" src="data/SP_Res_SinglePoint_Asc.js"></script>
    <script src="data/SPbnd.js"></script>

    <div id="map" class="sidebar-map">

        <script>
            //the variable map where everything else will be add
            var map = L.map('map', {
                'zoomControl': false,
            }).setView([-23.6759, -46.6468], 11);

            //zoom custom position
            L.control.zoom({
                position: 'topright'
            }).addTo(map);

            //the base map
            L.tileLayer("http://{s}.sm.mapstack.stamen.com/(toner-lite,$fff[difference],$fff[@23],$fff[hsl-saturation@20])/{z}/{x}/{y}.png", {
                maxZoom: 18,
                attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>'
            }).addTo(map);


            //function to get specif colors based on year
            function getColor(d) {
                return d < 1985 ? '#ffffd9' :
                    d < 1989 ? '#edf8b1' :
                    d < 1993 ? '#c7e9b4' :
                    d < 1997 ? '#7fcdbb' :
                    d < 2001 ? '#41b6c4' :
                    d < 2005 ? '#1d91c0' :
                    d < 2009 ? '#225ea8' :
                    d < 2013 ? '#0c2c84' :
                    '#130048';
            }

            //style function
            function Style(feature) {
                return {
                    fillColor: getColor(feature.properties.Time),
                    stroke: false,
                    opacity: 1,
                    color: "#000",
                    fillOpacity: 0.8,
                    weight: 1,
                    radius: 5
                };
            }

            //legend section
            var legend = L.control({
                position: 'bottomright'
            });

            legend.onAdd = function (map) {

                var div = L.DomUtil.create('div', 'info legend'),
                    grades = [1985, 1989, 1993, 1997, 2001, 2005, 2009, 2013],
                    labels = [];

                div.innerHTML += '<h1> Year Built </h1>';

                // loop through our getColor function intervals and generate a label with a colored square for each interval
                for (var i = 0; i < grades.length; i++) {
                    div.innerHTML +=
                        '<span style="background:' + getColor(grades[i] + 1) + '"></span> ';
                }

                //a line breaK
                div.innerHTML += '<br>';

                //second loop for text
                for (var i = 0; i < grades.length; i++) {
                    div.innerHTML +=
                        '<label>' + grades[i] + (grades[i + 1] ? ' - ' + grades[i + 1] : '') + '</label>';
                }

                return div;
            };

            legend.addTo(map);

            var geojsonMarkerOptions = {
                radius: 10,
                fillColor: "rgb(255,0,195)",
                color: "#fff",
                weight: 2,
                opacity: 1,
                fillOpacity: 1
            };

            var SaoPaulo = L.geoJson(SP_ResSinglePoint, {

                pointToLayer: function (feature, latlng) {
                    var popupContent = "<b>Year Built: </b>" + feature.properties.Time;
                    //console.log(popupContent);
                    return L.circleMarker(latlng, Style(feature)).bindPopup(popupContent);
                },

            });

            //Create sliderControl

            var sliderControl = L.control.sliderControl({
                position: "bottomright",
                layer: SaoPaulo,
                //range: true,
                timeAttribute: "Timestrg",
                follow: 1500,
				//alwaysShowDate: true,

            });

            //add sliderControl to the map
            map.addControl(sliderControl);

            //initialize sliderControl
            sliderControl.startSlider();



            L.geoJson(saopaulobnd, {
                weight: 2,
                opacity: 1,
                color: '#017fad',
                dashArray: '3',
                fillOpacity: 0
            }).addTo(map);
            
            var sidebar = L.control.sidebar('sidebar').addTo(map);
			
			//group the datasets
     var overlays = {
         "All Developments": SaoPaulo
     };


     //create the layer control
     L.control.layers(null, overlays, {
         collapsed: false,
         position: 'bottomright'
     }).addTo(map);
        </script>


    </div>

</body>
